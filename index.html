<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS LIFE OS v3.0</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect x='4' y='4' width='56' height='56' rx='18' fill='none' stroke='%2300f0ff' stroke-width='4'/%3E%3Ctext x='50%25' y='55%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='bold' fill='%2300f0ff' font-size='28' letter-spacing='-1'%3ENS%3C/text%3E%3C/svg%3E">

    <style>
        :root {
            /* Cores */
            --bg-core: #0a0a0a;     /* Um pouco menos preto absoluto para suavidade */
            --bg-panel: #161616;
            --bg-input: #222222;
            --primary: #00f0ff;
            --primary-dim: rgba(0, 240, 255, 0.15);
            --accent: #00ff9d;
            --danger: #ff477e;      /* Rosa mais suave que o vermelho */
            --text-main: #f0f0f0;
            --text-muted: #888888;
            --border: #333333;
            
            /* Tipografia e Formas */
            --font-stack: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif; /* Fonte mais moderna/limpa */
            --radius-card: 20px;
            --radius-btn: 50px;     /* Pill shape */
            --radius-input: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-core);
            color: var(--text-main);
            font-family: var(--font-stack);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            padding-top: 1rem;
        }

        /* --- Header --- */
        header {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
        }
        
        .logo-icon-header {
            width: 36px;
            height: 36px;
            margin-right: 12px;
            color: var(--primary);
            filter: drop-shadow(0 0 8px var(--primary-dim));
        }

        h1 span { color: var(--primary); font-weight: 300; margin-left: 5px; }

        .header-controls { display: flex; gap: 0.8rem; align-items: center; }

        /* --- Buttons (Pill Shape) --- */
        .btn {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--primary);
            padding: 0.6rem 1.2rem;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            border-radius: var(--radius-btn);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); border-color: var(--primary); }
        .btn:active { transform: translateY(0); }

        .btn-add { background: var(--primary); color: var(--bg-core); border: none; box-shadow: 0 0 15px var(--primary-dim); }
        .btn-add:hover { background: #33f3ff; color: black; box-shadow: 0 0 25px var(--primary-dim); }

        .btn-lang { min-width: 44px; padding: 0.6rem; border-color: transparent; color: var(--text-muted); }
        .btn-lang:hover { color: var(--text-main); background: var(--bg-input); border-color: var(--border); }

        .btn-danger { 
            color: var(--danger); 
            background: transparent;
            border: 1px solid rgba(255, 71, 126, 0.3);
            width: 32px; height: 32px; padding: 0;
            font-size: 1rem; line-height: 1;
        }
        .btn-danger:hover { background: var(--danger); color: white; border-color: var(--danger); }

        /* --- Grid & Cards --- */
        #protocol-grid {
            width: 100%;
            max-width: 800px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.2rem;
            padding-bottom: 4rem; /* Espa√ßo para scroll no mobile */
        }

        .card {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-card);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            transition: transform 0.2s, border-color 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .card:hover { border-color: #444; transform: translateY(-2px); }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .protocol-name { 
            font-size: 1.15rem; 
            font-weight: 600; 
            color: white; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .protocol-icon { 
            background: rgba(255,255,255,0.05); 
            width: 36px; height: 36px; 
            border-radius: 50%; 
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem;
        }
        
        .protocol-meta { 
            font-size: 0.7rem; 
            color: var(--text-muted); 
            margin-top: 0.4rem; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            background: rgba(255,255,255,0.03);
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }

        /* --- Progress Bar --- */
        .progress-container { 
            width: 100%; height: 10px; 
            background: var(--bg-core); 
            position: relative; overflow: hidden; 
            border-radius: 10px; 
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--primary), var(--accent)); 
            width: 0%; 
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); 
            border-radius: 10px;
        }
        .progress-fill.complete { background: var(--accent); }

        .stats { display: flex; justify-content: space-between; font-size: 0.85rem; font-weight: 500; margin-bottom: -0.5rem; }

        /* --- Inputs --- */
        .input-action-row { display: flex; gap: 0.8rem; margin-top: 0.5rem; }
        
        .input-fraction { 
            background: var(--bg-input); 
            border: 1px solid var(--border); 
            border-radius: var(--radius-input);
            color: white; 
            padding: 0.8rem 1rem; 
            width: 100%; 
            font-family: inherit;
            font-size: 1rem; /* Melhor para toque */
            transition: border-color 0.2s;
        }
        .input-fraction:focus { border-color: var(--primary); }

        /* --- Modal --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
            padding: 1rem;
        }
        .modal { 
            background: var(--bg-panel); 
            border: 1px solid var(--border); 
            border-radius: var(--radius-card);
            padding: 2rem; 
            width: 100%; 
            max-width: 420px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            animation: modalSlide 0.3s ease-out;
        }
        @keyframes modalSlide { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .form-group { margin-bottom: 1.2rem; }
        .form-group label { display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.6rem; font-weight: 500; }
        .form-control { 
            width: 100%; padding: 0.9rem; 
            background: var(--bg-input); 
            border: 1px solid var(--border); 
            border-radius: var(--radius-input);
            color: white; font-family: inherit; font-size: 1rem;
        }
        .form-control:focus { border-color: var(--primary); }

        .empty-state { text-align: center; color: var(--text-muted); padding: 4rem 1rem; border: 2px dashed var(--border); border-radius: var(--radius-card); width: 100%; grid-column: 1 / -1; }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 600px) {
            body { padding: 1rem; padding-top: 0.5rem; }
            
            header { flex-direction: row; margin-bottom: 1.5rem; }
            h1 { font-size: 1.2rem; }
            h1 span { display: none; } /* Esconde "Life OS" no mobile para economizar espa√ßo */

            #protocol-grid { grid-template-columns: 1fr; gap: 1rem; }
            
            .card { padding: 1.2rem; }
            
            /* Bot√µes maiores para toque */
            .btn { padding: 0.8rem 1.4rem; font-size: 0.9rem; }
            
            /* Modal ocupa tela inteira embaixo no mobile */
            .modal { 
                position: absolute; bottom: 0; margin: 0; 
                border-bottom-left-radius: 0; border-bottom-right-radius: 0;
                width: 100%; max-width: 100%; padding-bottom: 3rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>
            <svg class="logo-icon-header" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <rect x="4" y="4" width="56" height="56" rx="18" fill="none" stroke="currentColor" stroke-width="5"/>
                <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-weight="800" fill="currentColor" font-size="26" letter-spacing="-1">NS</text>
            </svg>
            Nexus <span>Life OS</span>
        </h1>
        <div class="header-controls">
            <button class="btn btn-lang" id="lang-btn" onclick="nexus.toggleLang()">EN</button>
            <button class="btn btn-add" id="add-btn" onclick="nexus.openModal()">+ Novo</button>
        </div>
    </header>

    <div id="protocol-grid">
        </div>

    <div id="modal-overlay"></div>

<script>
/**
 * NEXUS CORE ENGINE v3.0 (Soft UI & Mobile)
 */

const DICTIONARY = {
    pt: {
        addBtn: "+ Novo",
        emptyTitle: "SISTEMA OCIOSO",
        emptyDesc: "Toque em '+ Novo' para come√ßar seus protocolos.",
        cycle: "CICLO",
        cycles: { daily: "DI√ÅRIO", weekly: "SEMANAL", monthly: "MENSAL", infinite: "ACUMULATIVO" },
        btnSum: "SOMAR",
        btnCancel: "Cancelar",
        btnConfirm: "Salvar",
        modalTitle: "Criar Protocolo",
        lblNam: "Nome do Objetivo",
        phNam: "Ex: Ler Livro",
        lblTarget: "Meta",
        lblUnit: "Unidade",
        lblCycle: "Reset Autom√°tico",
        confirmDel: "Excluir este protocolo?"
    },
    en: {
        addBtn: "+ New",
        emptyTitle: "SYSTEM IDLE",
        emptyDesc: "Tap '+ New' to start your protocols.",
        cycle: "CYCLE",
        cycles: { daily: "DAILY", weekly: "WEEKLY", monthly: "MONTHLY", infinite: "ACCUMULATIVE" },
        btnSum: "ADD",
        btnCancel: "Cancel",
        btnConfirm: "Save",
        modalTitle: "Create Protocol",
        lblNam: "Goal Name",
        phNam: "Ex: Read Book",
        lblTarget: "Target",
        lblUnit: "Unit",
        lblCycle: "Auto Reset",
        confirmDel: "Delete this protocol?"
    }
};

class NexusOS {
    constructor() {
        this.lang = localStorage.getItem('nexus_lang') || 'pt'; 
        this.protocols = JSON.parse(localStorage.getItem('nexus_protocols')) || [];
        this.grid = document.getElementById('protocol-grid');
        this.modalOverlay = document.getElementById('modal-overlay');
        this.init();
    }

    init() {
        this.checkResets();
        this.updateStaticTexts();
        this.render();
    }

    t(key) {
        return key.split('.').reduce((obj, k) => (obj || {})[k], DICTIONARY[this.lang]) || key;
    }

    toggleLang() {
        this.lang = this.lang === 'pt' ? 'en' : 'pt';
        localStorage.setItem('nexus_lang', this.lang);
        this.updateStaticTexts();
        this.render();
    }

    updateStaticTexts() {
        document.getElementById('add-btn').innerText = this.t('addBtn');
        document.getElementById('lang-btn').innerText = this.lang.toUpperCase();
    }

    getIcon(name) {
        const n = name.toLowerCase();
        const icons = {
            '√°gua': 'üíß', 'hidrata': 'üíß', 'water': 'üíß', 'drink': 'üíß',
            'treino': 'üí™', 'gym': 'üí™', 'workout': 'üí™', 'muscula': 'üí™',
            'caminha': 'üë£', 'walk': 'üë£', 'run': 'üèÉ', 'correr': 'üèÉ', 'cardio': 'üèÉ',
            'ler': 'üìö', 'read': 'üìö', 'book': 'üìö', 'estudar': 'üß†', 'study': 'üß†',
            'code': 'üíª', 'codar': 'üíª', 'dev': 'üë®‚Äçüíª', 'java': '‚òï', 'js': 'üü®',
            'dinheiro': 'üí∞', 'money': 'üí∞', 'invest': 'üìà', 'profit': 'üìà',
            'medita': 'üßò', 'sleep': 'üí§', 'sono': 'üí§', 'foco': 'üéØ', 'focus': 'üéØ'
        };
        for (const key in icons) {
            if (n.includes(key)) return icons[key];
        }
        return '‚ö°';
    }

    checkResets() {
        const now = new Date();
        let hasChanges = false;
        this.protocols = this.protocols.map(p => {
            const lastUpdate = new Date(p.lastReset || 0);
            let shouldReset = false;
            if (p.cycle === 'daily') {
                if (now.toDateString() !== lastUpdate.toDateString()) shouldReset = true;
            } else if (p.cycle === 'weekly') {
                const currentMonday = this.getMonday(now);
                if (lastUpdate < currentMonday) shouldReset = true;
            } else if (p.cycle === 'monthly') {
                if (now.getMonth() !== lastUpdate.getMonth() || now.getFullYear() !== lastUpdate.getFullYear()) shouldReset = true;
            }
            if (shouldReset && p.current > 0) {
                p.current = 0; p.lastReset = now.toISOString(); hasChanges = true;
            }
            if (!p.lastReset) { p.lastReset = now.toISOString(); hasChanges = true; }
            return p;
        });
        if (hasChanges) this.save();
    }

    getMonday(d) {
        d = new Date(d);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        const monday = new Date(d.setDate(diff));
        monday.setHours(0,0,0,0);
        return monday;
    }

    save() {
        localStorage.setItem('nexus_protocols', JSON.stringify(this.protocols));
        this.render();
    }

    addProgress(id, amount) {
        const value = parseFloat(amount);
        if (isNaN(value) || value === 0) return;
        this.protocols = this.protocols.map(p => {
            if (p.id === id) p.current = Math.round((p.current + value) * 100) / 100;
            return p;
        });
        this.save();
    }

    createProtocol() {
        const name = document.getElementById('p-name').value;
        const target = parseFloat(document.getElementById('p-target').value);
        const unit = document.getElementById('p-unit').value;
        const cycle = document.getElementById('p-cycle').value;
        if (!name || !target) return;
        this.protocols.push({
            id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
            name, target, unit, cycle, current: 0, lastReset: new Date().toISOString()
        });
        this.closeModal(); this.save();
    }

    deleteProtocol(id) {
        if(confirm(this.t('confirmDel'))) {
            this.protocols = this.protocols.filter(p => p.id !== id);
            this.save();
        }
    }

    render() {
        this.grid.innerHTML = '';
        if (this.protocols.length === 0) {
            this.grid.innerHTML = `<div class="empty-state"><h3>${this.t('emptyTitle')}</h3><p>${this.t('emptyDesc')}</p></div>`;
            return;
        }
        this.protocols.forEach(p => {
            const percentage = Math.min((p.current / p.target) * 100, 100);
            const isComplete = p.current >= p.target;
            const icon = this.getIcon(p.name);
            const cycleLabel = this.t(`cycles.${p.cycle}`);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <div class="protocol-name"><span class="protocol-icon">${icon}</span> ${p.name}</div>
                        <div class="protocol-meta">${cycleLabel}</div>
                    </div>
                    <button class="btn btn-danger" onclick="nexus.deleteProtocol('${p.id}')">‚úï</button>
                </div>
                <div class="stats">
                    <span style="color: ${isComplete ? 'var(--accent)' : 'var(--text-main)'}">
                        ${p.current} <span style="color:var(--text-muted)">/ ${p.target} ${p.unit}</span>
                    </span>
                    <span>${percentage.toFixed(0)}%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-fill ${isComplete ? 'complete' : ''}" style="width: ${percentage}%"></div>
                </div>
                <div class="input-action-row">
                    <input type="number" class="input-fraction" id="input-${p.id}" placeholder="Input" onkeydown="if(event.key === 'Enter') nexus.handleInput('${p.id}')">
                    <button class="btn" style="padding: 0 1.5rem" onclick="nexus.handleInput('${p.id}')">${this.t('btnSum')}</button>
                </div>
            `;
            this.grid.appendChild(card);
        });
    }

    openModal() {
        this.modalOverlay.innerHTML = `
            <div class="modal">
                <h2 style="margin-bottom: 1.5rem; color: var(--primary); display:flex; align-items:center; gap:10px; font-size:1.2rem">
                    <svg class="logo-icon-header" style="width:28px;height:28px" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="56" height="56" rx="18" fill="none" stroke="currentColor" stroke-width="5"/><text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-weight="800" fill="currentColor" font-size="26" letter-spacing="-1">NS</text></svg>
                    ${this.t('modalTitle')}
                </h2>
                <div class="form-group"><label>${this.t('lblNam')}</label><input type="text" id="p-name" class="form-control" placeholder="${this.t('phNam')}"></div>
                <div class="input-action-row">
                    <div class="form-group" style="flex: 1"><label>${this.t('lblTarget')}</label><input type="number" id="p-target" class="form-control" placeholder="100"></div>
                    <div class="form-group" style="flex: 1"><label>${this.t('lblUnit')}</label><input type="text" id="p-unit" class="form-control" placeholder="ml, min"></div>
                </div>
                <div class="form-group"><label>${this.t('lblCycle')}</label>
                    <select id="p-cycle" class="form-control">
                        <option value="daily">${this.t('cycles.daily')}</option><option value="weekly">${this.t('cycles.weekly')}</option><option value="monthly">${this.t('cycles.monthly')}</option><option value="infinite">${this.t('cycles.infinite')}</option>
                    </select>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem;">
                    <button class="btn" style="background:transparent; border:none; color:var(--text-muted)" onclick="nexus.closeModal()">${this.t('btnCancel')}</button>
                    <button class="btn btn-add" onclick="nexus.createProtocol()">${this.t('btnConfirm')}</button>
                </div>
            </div>
        `;
        this.modalOverlay.style.display = 'flex';
        setTimeout(() => document.getElementById('p-name').focus(), 100);
    }

    closeModal() { this.modalOverlay.style.display = 'none'; }
}

document.addEventListener('DOMContentLoaded', () => {
    try { window.nexus = new NexusOS(); } catch (e) { console.error(e); document.body.innerHTML = "<h2 style='color:red'>Erro fatal. Verifique o console.</h2>"; }
});
document.getElementById('modal-overlay').addEventListener('click', (e) => { if (e.target.id === 'modal-overlay') nexus.closeModal(); });
</script>
</body>
</html>