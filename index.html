<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS LIFE OS v2.1</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect x='4' y='4' width='56' height='56' rx='12' fill='none' stroke='%2300f0ff' stroke-width='4'/%3E%3Ctext x='50%25' y='55%25' dominant-baseline='middle' text-anchor='middle' font-family='monospace' font-weight='bold' fill='%2300f0ff' font-size='30' letter-spacing='-2'%3ENS%3C/text%3E%3C/svg%3E">

    <style>
        :root {
            --bg-core: #050505;
            --bg-panel: #111111;
            --bg-input: #1a1a1a;
            --primary: #00f0ff; /* Cyberpunk Cyan */
            --primary-dim: rgba(0, 240, 255, 0.1);
            --accent: #00ff9d; /* Neon Green */
            --danger: #ff2a6d;
            --text-main: #e0e0e0;
            --text-muted: #666666;
            --border: #333333;
            --font-stack: 'SF Mono', 'Fira Code', 'Courier New', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            background-color: var(--bg-core);
            color: var(--text-main);
            font-family: var(--font-stack);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        /* --- Header & Controls --- */
        header {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        /* Atualiza√ß√£o no H1 para alinhar o logo */
        h1 {
            font-size: 1.5rem;
            letter-spacing: -1px;
            text-transform: uppercase;
            display: flex;
            align-items: center; /* Alinha o SVG verticalmente com o texto */
        }
        
        /* Estilo do Logo SVG no Header */
        .logo-icon-header {
            width: 32px;
            height: 32px;
            margin-right: 12px;
            color: var(--primary); /* O SVG herda essa cor */
        }

        h1 span { color: var(--primary); }

        .header-controls { display: flex; gap: 1rem; align-items: center; }

        /* --- Buttons --- */
        .btn {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--primary);
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .btn:hover { background: var(--primary); color: var(--bg-core); box-shadow: 0 0 15px var(--primary-dim); }
        .btn-add { background: var(--primary-dim); border-color: var(--primary); }
        
        .btn-lang {
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            border-color: var(--text-muted);
            color: var(--text-muted);
        }
        .btn-lang:hover { border-color: var(--primary); color: var(--primary); background: transparent; }

        .btn-danger { color: var(--danger); border-color: #333; font-size: 0.7rem; padding: 0.2rem 0.5rem; }
        .btn-danger:hover { background: var(--danger); color: white; }

        /* --- Grid & Cards --- */
        #protocol-grid {
            width: 100%;
            max-width: 800px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .protocol-name { font-size: 1.1rem; font-weight: bold; color: white; display: flex; align-items: center; gap: 8px; }
        .protocol-icon { filter: grayscale(30%); font-size: 1.2rem; }
        
        .protocol-meta { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.2rem; text-transform: uppercase; letter-spacing: 1px; }

        /* --- Progress Bar --- */
        .progress-container { width: 100%; height: 6px; background: var(--bg-input); position: relative; overflow: hidden; border-radius: 2px; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s ease-out; box-shadow: 0 0 10px var(--primary); }
        .progress-fill.complete { background: var(--accent); box-shadow: 0 0 10px var(--accent); }

        .stats { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: -0.5rem; }

        /* --- Inputs --- */
        .input-action-row { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        .input-fraction { background: var(--bg-input); border: 1px solid var(--border); color: white; padding: 0.5rem; width: 100%; font-family: inherit; }
        .input-fraction:focus { border-color: var(--primary); }

        /* --- Modal --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(4px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal { background: var(--bg-panel); border: 1px solid var(--primary); padding: 2rem; width: 90%; max-width: 400px; box-shadow: 0 0 30px rgba(0, 240, 255, 0.15); }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.4rem; }
        .form-control { width: 100%; padding: 0.8rem; background: var(--bg-input); border: 1px solid var(--border); color: white; font-family: inherit; }

        .empty-state { text-align: center; color: var(--text-muted); padding: 4rem; border: 1px dashed var(--border); width: 100%; grid-column: 1 / -1; }
    </style>
</head>
<body>

    <header>
        <h1>
            <svg class="logo-icon-header" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <rect x="4" y="4" width="56" height="56" rx="12" fill="none" stroke="currentColor" stroke-width="4"/>
                <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-family="monospace" font-weight="bold" fill="currentColor" font-size="30" letter-spacing="-2">NS</text>
            </svg>
            Nexus <span>Life OS</span>
        </h1>
        <div class="header-controls">
            <button class="btn btn-lang" id="lang-btn" onclick="nexus.toggleLang()">EN</button>
            <button class="btn btn-add" id="add-btn" onclick="nexus.openModal()">+ Novo</button>
        </div>
    </header>

    <div id="protocol-grid">
        </div>

    <div id="modal-overlay"></div>

<script>
/**
 * NEXUS CORE ENGINE v2.1 (I18N + Context AI + Branding)
 * Author: Rodrigo - Senior Architect
 */

const DICTIONARY = {
    pt: {
        addBtn: "+ Novo Protocolo",
        emptyTitle: "SISTEMA OCIOSO",
        emptyDesc: "Nenhum protocolo ativo detectado. Inicie a configura√ß√£o.",
        cycle: "CICLO",
        cycles: {
            daily: "DI√ÅRIO",
            weekly: "SEMANAL",
            monthly: "MENSAL",
            infinite: "ACUMULATIVO"
        },
        btnSum: "SOMAR",
        btnCancel: "Cancelar",
        btnConfirm: "Confirmar",
        modalTitle: "Definir Protocolo",
        lblNam: "Nome do Objetivo",
        phNam: "Ex: Leitura Profunda",
        lblTarget: "Meta Num√©rica",
        lblUnit: "Unidade",
        lblCycle: "Ciclo de Reset",
        confirmDel: "Arquivar este protocolo permanentemente?"
    },
    en: {
        addBtn: "+ New Protocol",
        emptyTitle: "SYSTEM IDLE",
        emptyDesc: "No active protocols detected. Start configuration.",
        cycle: "CYCLE",
        cycles: {
            daily: "DAILY",
            weekly: "WEEKLY",
            monthly: "MONTHLY",
            infinite: "ACCUMULATIVE"
        },
        btnSum: "ADD",
        btnCancel: "Cancel",
        btnConfirm: "Confirm",
        modalTitle: "Define Protocol",
        lblNam: "Goal Name",
        phNam: "Ex: Deep Reading",
        lblTarget: "Numeric Target",
        lblUnit: "Unit",
        lblCycle: "Reset Cycle",
        confirmDel: "Archive this protocol permanently?"
    }
};

class NexusOS {
    constructor() {
        this.lang = localStorage.getItem('nexus_lang') || 'pt'; 
        this.protocols = JSON.parse(localStorage.getItem('nexus_protocols')) || [];
        this.grid = document.getElementById('protocol-grid');
        this.modalOverlay = document.getElementById('modal-overlay');
        this.init();
    }

    init() {
        this.checkResets();
        this.updateStaticTexts();
        this.render();
    }

    t(key) {
        return key.split('.').reduce((obj, k) => (obj || {})[k], DICTIONARY[this.lang]) || key;
    }

    toggleLang() {
        this.lang = this.lang === 'pt' ? 'en' : 'pt';
        localStorage.setItem('nexus_lang', this.lang);
        this.updateStaticTexts();
        this.render();
    }

    updateStaticTexts() {
        document.getElementById('add-btn').innerText = this.t('addBtn');
        document.getElementById('lang-btn').innerText = this.lang.toUpperCase();
    }

    getIcon(name) {
        const n = name.toLowerCase();
        const icons = {
            '√°gua': 'üíß', 'hidrata': 'üíß', 'water': 'üíß', 'drink': 'üíß',
            'treino': 'üí™', 'gym': 'üí™', 'workout': 'üí™', 'muscula': 'üí™',
            'caminha': 'üë£', 'walk': 'üë£', 'run': 'üèÉ', 'correr': 'üèÉ', 'cardio': 'üèÉ',
            'ler': 'üìö', 'read': 'üìö', 'book': 'üìö', 'estudar': 'üß†', 'study': 'üß†',
            'code': 'üíª', 'codar': 'üíª', 'dev': 'üë®‚Äçüíª', 'java': '‚òï', 'js': 'üü®',
            'dinheiro': 'üí∞', 'money': 'üí∞', 'invest': 'üìà', 'profit': 'üìà',
            'medita': 'üßò', 'sleep': 'üí§', 'sono': 'üí§', 'foco': 'üéØ', 'focus': 'üéØ'
        };
        for (const key in icons) {
            if (n.includes(key)) return icons[key];
        }
        return '‚ö°';
    }

    checkResets() {
        const now = new Date();
        let hasChanges = false;
        this.protocols = this.protocols.map(p => {
            const lastUpdate = new Date(p.lastReset || 0);
            let shouldReset = false;
            if (p.cycle === 'daily') {
                if (now.toDateString() !== lastUpdate.toDateString()) shouldReset = true;
            } else if (p.cycle === 'weekly') {
                const currentMonday = this.getMonday(now);
                if (lastUpdate < currentMonday) shouldReset = true;
            } else if (p.cycle === 'monthly') {
                if (now.getMonth() !== lastUpdate.getMonth() || now.getFullYear() !== lastUpdate.getFullYear()) shouldReset = true;
            }
            if (shouldReset && p.current > 0) {
                p.current = 0; p.lastReset = now.toISOString(); hasChanges = true;
            }
            if (!p.lastReset) { p.lastReset = now.toISOString(); hasChanges = true; }
            return p;
        });
        if (hasChanges) this.save();
    }

    getMonday(d) {
        d = new Date(d);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        const monday = new Date(d.setDate(diff));
        monday.setHours(0,0,0,0);
        return monday;
    }

    save() {
        localStorage.setItem('nexus_protocols', JSON.stringify(this.protocols));
        this.render();
    }

    addProgress(id, amount) {
        const value = parseFloat(amount);
        if (isNaN(value) || value === 0) return;
        this.protocols = this.protocols.map(p => {
            if (p.id === id) p.current = Math.round((p.current + value) * 100) / 100;
            return p;
        });
        this.save();
    }

    createProtocol() {
        const name = document.getElementById('p-name').value;
        const target = parseFloat(document.getElementById('p-target').value);
        const unit = document.getElementById('p-unit').value;
        const cycle = document.getElementById('p-cycle').value;
        if (!name || !target) return;
        this.protocols.push({
            id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
            name, target, unit, cycle, current: 0, lastReset: new Date().toISOString()
        });
        this.closeModal(); this.save();
    }

    deleteProtocol(id) {
        if(confirm(this.t('confirmDel'))) {
            this.protocols = this.protocols.filter(p => p.id !== id);
            this.save();
        }
    }

    render() {
        this.grid.innerHTML = '';
        if (this.protocols.length === 0) {
            this.grid.innerHTML = `<div class="empty-state"><h3>${this.t('emptyTitle')}</h3><p>${this.t('emptyDesc')}</p></div>`;
            return;
        }
        this.protocols.forEach(p => {
            const percentage = Math.min((p.current / p.target) * 100, 100);
            const isComplete = p.current >= p.target;
            const icon = this.getIcon(p.name);
            const cycleLabel = this.t(`cycles.${p.cycle}`);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <div class="protocol-name"><span class="protocol-icon">${icon}</span> ${p.name}</div>
                        <div class="protocol-meta">${this.t('cycle')}: ${cycleLabel}</div>
                    </div>
                    <button class="btn btn-danger" onclick="nexus.deleteProtocol('${p.id}')">X</button>
                </div>
                <div class="stats">
                    <span style="color: ${isComplete ? 'var(--accent)' : 'var(--text-main)'}">
                        ${p.current} <span style="color:var(--text-muted)">/ ${p.target} ${p.unit}</span>
                    </span>
                    <span>${percentage.toFixed(0)}%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-fill ${isComplete ? 'complete' : ''}" style="width: ${percentage}%"></div>
                </div>
                <div class="input-action-row">
                    <input type="number" class="input-fraction" id="input-${p.id}" placeholder="Input" onkeydown="if(event.key === 'Enter') nexus.handleInput('${p.id}')">
                    <button class="btn" onclick="nexus.handleInput('${p.id}')">${this.t('btnSum')}</button>
                </div>
            `;
            this.grid.appendChild(card);
        });
    }

    handleInput(id) {
        const input = document.getElementById(`input-${id}`);
        this.addProgress(id, input.value);
        input.value = ''; input.focus();
    }

    openModal() {
        this.modalOverlay.innerHTML = `
            <div class="modal">
                <h2 style="margin-bottom: 1.5rem; color: var(--primary); display:flex; align-items:center; gap:10px">
                    <svg class="logo-icon-header" style="width:24px;height:24px" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="56" height="56" rx="12" fill="none" stroke="currentColor" stroke-width="4"/><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" font-family="monospace" font-weight="bold" fill="currentColor" font-size="30" letter-spacing="-2">NS</text></svg>
                    ${this.t('modalTitle')}
                </h2>
                <div class="form-group"><label>${this.t('lblNam')}</label><input type="text" id="p-name" class="form-control" placeholder="${this.t('phNam')}"></div>
                <div class="input-action-row">
                    <div class="form-group" style="flex: 1"><label>${this.t('lblTarget')}</label><input type="number" id="p-target" class="form-control" placeholder="100"></div>
                    <div class="form-group" style="flex: 1"><label>${this.t('lblUnit')}</label><input type="text" id="p-unit" class="form-control" placeholder="ml, min"></div>
                </div>
                <div class="form-group"><label>${this.t('lblCycle')}</label>
                    <select id="p-cycle" class="form-control">
                        <option value="daily">${this.t('cycles.daily')}</option><option value="weekly">${this.t('cycles.weekly')}</option><option value="monthly">${this.t('cycles.monthly')}</option><option value="infinite">${this.t('cycles.infinite')}</option>
                    </select>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                    <button class="btn" onclick="nexus.closeModal()">${this.t('btnCancel')}</button>
                    <button class="btn btn-add" onclick="nexus.createProtocol()">${this.t('btnConfirm')}</button>
                </div>
            </div>
        `;
        this.modalOverlay.style.display = 'flex';
        setTimeout(() => document.getElementById('p-name').focus(), 100);
    }

    closeModal() { this.modalOverlay.style.display = 'none'; }
}

document.addEventListener('DOMContentLoaded', () => {
    try { window.nexus = new NexusOS(); } catch (e) { console.error(e); document.body.innerHTML = "<h2 style='color:red'>Erro fatal. Verifique o console.</h2>"; }
});
document.getElementById('modal-overlay').addEventListener('click', (e) => { if (e.target.id === 'modal-overlay') nexus.closeModal(); });
</script>
</body>
</html>